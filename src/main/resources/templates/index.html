<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>Inventar — Početna</title>
</head>
<style>
    .large-button {
        width: 50%;
        margin: 2rem auto;
        font-size: 2em;
    }
</style>
<body>


<h1 class="display-2 m-3 text-center">Inventar</h1>

<div class="container-fluid">
    <a href="/ugovori" class="btn btn-block btn-primary large-button">Ugovori</a>
    <a href="/ulaz" class="btn btn-block btn-success large-button">Računi</a>
    <a href="/izlaz" class="btn btn-block btn-warning large-button">Utrošak</a>

    <div class="text-center" style="margin: 4rem auto 0 auto">
        <label>
            Na dan:
            <input type="date" name="state-datum" class="form-control">
        </label>
    </div>
    <a href="#" class="btn btn-block btn-dark large-button" style="margin-top: 0; margin-bottom: 0;" id="state">Stanje</a>
    <div class="text-center" style="margin: 1rem auto 0 auto">
        <label>
            Od:
            <input type="date" name="report-datum" class="form-control">
        </label>
        <label>
            Do:
            <input type="date" name="report-until" class="form-control">
        </label>
    </div>
    <a href="#" class="btn btn-block btn-info large-button" style="margin-top: 0" id="report">Izveštaj</a>
    <a href="/changes" class="btn btn-block btn-secondary large-button">Pregled svih izmena</a>
</div>
</body>

<script>
    Date.prototype.toDateInputValue = (function() {
        let local = new Date(this);
        local.setMinutes(this.getMinutes() - this.getTimezoneOffset());
        return local.toJSON().slice(0,10);
    })
    Date.prototype.toDashString = (function () {
        let dateInMonth = this.getDate() < 10 ? '0' + this.getDate() : this.getDate()
        let month = this.getMonth() < 9 ? '0' + (this.getMonth() + 1).toString() : (this.getMonth()+1).toString()
        return dateInMonth + '-' + month + '-' + this.getFullYear()
    })
    const today = new Date()

    let datePicker = document.getElementsByName('state-datum')[0]
    datePicker.value = today.toDateInputValue()

    document.getElementById('state').addEventListener('click', function () {
        let date = new Date(datePicker.value)
        window.location.href = `/state?date=${date.toDashString()}`
    })

    let reportDate = document.getElementsByName('report-datum')[0]
    const oneMonthAgo = new Date()
    oneMonthAgo.setMonth(today.getMonth()-1)
    reportDate.value = oneMonthAgo.toDateInputValue()
    let reportUntil = document.getElementsByName('report-until')[0]
    reportUntil.value = today.toDateInputValue()
    document.getElementById('report').addEventListener('click', function () {
        let date = new Date(reportDate.value)
        let until = new Date(reportUntil.value)
        window.location.href = `/report?date=${date.toDashString()}&until=${until.toDashString()}&columns=+Preostalo na ugovoru&columns=+Stanje&columns=-Stanje&colnames=Ugovori&colnames=Računi&colnames=Utrošak`
    })
</script>
</html>